# Build NodeJS Express app using Azure Pipelines
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript?view=vsts
variables:
  configuration: release
  platform: x64

steps:
- task: NodeTool@0
  inputs:
    versionSpec: 11.2.0
    checkLatest: true
    platform: $(platform)

- task: Npm@1
  displayName: 'npm install'
  inputs:
    command: install

- script: |
    npm run build

- task: CopyFiles@2
  displayName: 'Copy Files to: $(Build.ArtifactStagingDirectory)'
  inputs:
    SourceFolder: dist
    Contents: |
     dist/*.exe
    TargetFolder: '$(Build.ArtifactStagingDirectory)'

- task: PowerShell@2
  displayName: 'PowerShell Script'
  inputs:
    targetType: filePath
    filePath: ./version.ps1

- task: GitHubRelease@0
  inputs:
    gitHubConnection: 'Github'
    repositoryName: '$(Build.Repository.Name)' 
    action: 'edit'
    target: '$(Build.SourceVersion)' 
    tagSource: 'manual' # Required when action == Create# Options: auto, manual
    tag: '$(NPM_VER)'
    title: 'Release - v$(NPM_VER)'
    #releaseNotesSource: 'file' # Optional. Options: file, input
    #releaseNotesFile: # Optional
    #releaseNotes: # Optional
    assets: '$(Build.ArtifactStagingDirectory)/*' # Optional
    #assetUploadMode: 'delete' # Optional. Options: delete, replace
    isDraft: true # Optional
    isPreRelease: false # Optional
    addChangeLog: true # Optional




    
#- task: Npm@1
#  displayName: 'npm test'
#  inputs:
#    command: custom
#    customCommand: 'test'
#
#- task: PublishTestResults@2
#  inputs:
#    testResultsFiles: '**/TEST-RESULTS.xml'
#    testRunTitle: 'Test results for JavaScript'
#  condition: succeededOrFailed()
#
#- task: PublishCodeCoverageResults@1
#  inputs: 
#    codeCoverageTool: Cobertura
#    summaryFileLocation: '$(System.DefaultWorkingDirectory)/**/*coverage.xml'
#    reportDirectory: '$(System.DefaultWorkingDirectory)/**/coverage'
#   
#- task: ArchiveFiles@2
#  inputs:
#    rootFolderOrFile: '$(System.DefaultWorkingDirectory)'
#    includeRootFolder: false

#- task: PublishBuildArtifacts@1
   